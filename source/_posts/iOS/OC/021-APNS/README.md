---
title: APNS推送
date: {{ date }}
tags:
- iOS
- 面试题
- APNS
- 推送
---

苹果推送通知服务 (Apple Push Notification Service，APNS) 是苹果公司提供的推送通知平台，用于将通知从第三方应用服务器发送到 iOS 设备。APNS 是 iOS 应用开发中非常重要的一部分，因为它允许应用在不运行的情况下仍能接收信息和更新。

<!-- more -->

## 一、之前的总结
[我的简书-iOS的推送服务APNs详解](https://www.jianshu.com/p/a1c68ca79dbf)

## 二、推送通知的类型

推送通知分为本地推送与远程推送

本地推送最大推送数量是64个，超过这个数量会被忽略

本地推送：不需要联网也可以推送，是开发人员在APP内设定特定的时间来提醒用户干什么

本地通知与远程通知都可以向不在前台运行的应用发送消息，这种消息既可能是即将发生的事件，也可能是服务器的新数据，不管是本地还是远程通知，他们在界面上的显示效果是相同的。

二者的区别是本地推送是由本应用负责调用，只能从当前设备上的iOS发出。而远程推送是由服务器来控制。

## 三、推送通知的流程

1. 应用程序注册消息推送。

2. iOS从APNS Server获取device token，应用程序接收device token。 

3. 应用程序将device token发送给PUSH服务端程序。

4. 服务端程序向APNS服务发送消息。

5. APNS服务将消息发送给iPhone应用程序

![](003.webp)

### 1. 推送前

1. Device连接APNs服务器并携带设备序列号 

2. 连接成功，APNs经过打包和处理产生device_token并返回给注册的Device 

3. Device携带获取的device_token向我们自己的应用服务器注册 

4. 完成需要推送的Device在APNs服务器和我们自己的应用服务器注册 

![](001.webp)

### 2. 推送中

1. 首先，安装了具有推送功能的应用，我们的设备在有网络的情况下会连接苹果推送服务器，连接过程中，APNS会验证device_token，连接成功后维持一个长连接； 

2. Provider(我们自己的服务器)收到需要被推送的消息并结合被推送设备的device_token一起打包发送给APNS服务器； 

3. APNS服务器将推送信息推送给指定device_token的设备； 

4. 设备收到推送消息后通知我们的应用程序并显示和提示用户（声音、弹出框） 

![](002.webp)






